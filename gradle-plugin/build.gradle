plugins {
  id 'org.jetbrains.kotlin.jvm'
  id 'java-gradle-plugin'
  id 'maven-publish'
  id 'com.gradle.plugin-publish' version "0.10.1"
  id 'com.jfrog.bintray' version "1.8.4"
}

repositories {
  mavenCentral()
  jcenter()
}

dependencies {
  implementation gradleApi()
  implementation "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
  implementation "org.jetbrains.kotlin:kotlin-gradle-plugin-api:$kotlin_version"
  compileOnly project(":compiler-plugin") { "embeddable" }
}

compileKotlin {
  kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
  kotlinOptions.jvmTarget = "1.8"
}

jar {
  // Embed compiler plugin in jar
  configurations.named("compileClasspath").get().find { it.name.startsWith("plugin-compiler") }

  manifest {
    attributes["Specification-Title"] = project.name
    attributes["Specification-Version"] = project.version
    attributes["Implementation-Title"] = "arrow.meta.plugin.gradle"
    attributes["Implementation-Version"] = project.version
  }
}

gradlePlugin {
  plugins {
    create("arrow") {
      id = "arrow.meta.plugin.gradle"
      implementationClass = "arrow.meta.plugin.gradle.GeneratedGradleSubplugin"
    }
  }
}

