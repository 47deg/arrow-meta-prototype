apply plugin: 'kotlin'

repositories {
    flatDir {
        dirs "$rootDir/core/build/libs"
    }
}

def compilerPlugin = project(':compiler-plugin')

evaluationDependsOn(":$compilerPlugin.name")

compileKotlin.kotlinOptions.freeCompilerArgs = ["-Xplugin=${new File(compilerPlugin.buildDir, "libs/${compilerPlugin.name}.jar")}"]

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
    compile "org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"
}

afterEvaluate {
    tasks["compileKotlin"].dependsOn += compilerPlugin.tasks["jar"]
}

dependencies {
    implementation "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
    compile project(':core')
    implementation name: "core"
}

task execute(type:JavaExec) {
    main = "consumer.test"
    classpath = sourceSets.main.runtimeClasspath
}